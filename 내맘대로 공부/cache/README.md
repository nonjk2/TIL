- [Cache](#cache)
  - [서버 캐시](#서버-캐시)
  - [클라이언트 캐시](#클라이언트-캐시)
  - [네트워크 캐시](#네트워크-캐시)
  - [캐시 히트와 미스](#캐시-히트와-미스)
  - [캐시 제어와 무효화](#캐시-제어와-무효화)
    - [헤더 예시](#헤더-예시)
  - [캐시 보안 및 개인 정보 보호](#캐시-보안-및-개인-정보-보호)
  - [캐시 사용 사례](#캐시-사용-사례)
  - [캐시의 이점과 한계](#캐시의-이점과-한계)
  - [실제 시나리오 및 예제](#실제-시나리오-및-예제)

# Cache

- ### 캐시란 무엇일까 ?

  - 컴퓨터 공학이 발전할수록 자원적으로 이점이있는 캐시가 점차 많이 사용되고있다.
    캐시는 이전에 액세스한 데이터 또는 정보의 복사본을 임시로 저장하는 메커니즘을 가리킨다. 캐시는 데이터에
    빠르게 액세스 할 수 있도록 도와주고, 느린 데이터 소스로부터 데이터를 검색하는 대신 빠른 캐시에서 데어터를 가져오므로 성능을 향상시킬 수 있다.

- ### 왜 캐시를 사용할까 ?

  - 캐시는 주로 데이터 액세스의 **속도와 효율성을 개선하기 위해 사용된다**. 빈번하게 액세스 되는 데이터를 메모리 또는 더 빠른 저장 매체에 저장하여 데이터 검색 시간을 줄이고, 웹페이지 로딩 속도를 향상시키며 , 서버 부하를 줄이는 데에 도움이 된다.

- ### 캐시 동작 원리는 ?

  - 캐시는 데이터를 저장하고 검색할때에 키-값 쌍을 사용한다. 데이터를 가져오려면 먼저 캐시에서 해당 키를 검색하고, 키가 캐시에 존재하면 해당 데이터를 반환하고, 그렇지 않으면 원본 데이터 소스에서 데이터를 가져와 캐시에 저장한다.

- ### 그렇다면 캐시는 어디에 저장될까???

  - 캐시를 키-값 쌍으로 키를 가져와서 데이터에 접근을하여 빠르게 조회를 한다면 그 캐시는 어디에 존재할까

  1. 메모리 (Memory Chache)

     - 메모리 캐시는 데이터를 시스템의 RAM(Random Access Memory)에 저장한다.
     - 가장 빠른 액세스 속도를 제공하고 주로 클라이언트 또는 서버의 메모리에 캐시 데이터를 보관하는데 사용된다.
     - 메모리 캐시는 데이터에 대한 빠른 액세스가 필요한 경우에 이상적이다. 예를 들면 웹페이지의 이미지, 스타일시트, 스크립트, API 응답 및 기타 정적 파일은 메모리 캐시에 저장될 수 있다.

  2. 디스크

     - 디스크 캐시는 데이터를 하드 디스크에 저장한다.
     - 메모리 캐시에 비해 액세스 속도가 느리지만 더 많은 데이터를 저장할 수 있고 데이터가 메모리에서 제거되더라도 보존된다. 디스크 캐시는 브라우저 캐시, 서버의 파일 시스템 캐싱 및 데이터베이스 캐싱과 같은 다양한 용도로 사용된다.

  3. 브라우저 캐시

     - 웹 브라우저는 웹 페이지에서 정적 리소스(이미지, 스타일시트, 스크립트)를 캐시할 수 있다.사용자가 동일한 웹 사이트를 방문할 때에 같은 리소스를 다시 다운로드하지 않도록 한다. 브라우저 캐시는 클라이언트 측 캐시로 작동하고 사용자의 로컬 디스크에 저장된다.

  4. `CDN`(Content Delivery Network)

     - 콘텐츠를 전 세계적으로 분산된 서버에 저장하고 캐시하여 웹 콘텐츠를 빠르게 전달하는 데 사용된다.
     - `CDN`은 정적 콘텐츠를 효과적으로 캐시하고 액세스 속도를 향상시킨다.

  5. 서버 측 캐시

     - 서버 측 캐시는 서버에서 동적 콘텐츠 또는 API 응답을 캐시하는 데에 사용된다.
     - Redis , Memcached 및 HTTP 서버 (예 : Nginx, Apache)와 같은 도구 및 기술을 사용해 서버 측 캐시를 구현 할 수 있다.

## 서버 캐시

- **서버 캐시란 ?**

  - 서버 캐시는 서버에서 데이터나 웹 페이지의 복사본을 저장하고 클라이언트 요청에따라 그 데이터를 반환하는 서버측 캐싱 메커니즘을 가리킨다.
  - 서버 캐시는 주로 동적 콘텐츠를 정적 콘텐츠로 변환하거나 반복적인 계산을 피하기 위해 사용

- **서버 캐시의 역할**

  - 서버 캐시는 클라이언트의 요청에 대한 응답을 캐싱하여 같은 요청에 대한 반복적인 응답을 제공한다.
  - 서버 부하 감소 , 응답시간 단축의 큰 이점이 있다.

- **서버 캐시 사용 사례**

  - 서버 캐시는 동적 웹 페이지, API응답 , 데이터 베이스 쿼리 결과 및 기타 동적 콘텐츠를 캐싱할 때에 사용된다. 예를 들어, 동적 웹 페이지에서 정적 리소스(이미지, CSS, JavaScript)를 캐싱해 웹 페이지 로딩 속도를 향상시키는 데 사용된다.

- **서버 캐시 구현**
  - 서버 캐시를 구현하기 위해 Redis, Memcached, Nginx , Apache HTTP Server 등과 같은 도구와 기술을 사용할 수 있다. Redis 및 Memcached는 메모리 기반 캐시로 주로 사용되고, Nginx와 Apache는 웹 서버 레벨에서 캐싱을 수행할 수있다.

> 역사적으로 살펴보자(개인적인 의견)
>
> 2010년도이전에는 서버사이드랜더링으로 캐시메모리를 활용안했을때에고 이 이후부터 클라이언트의 스펙이올라가므로서 SPA가 인기를 얻으면서 클라이언트 측 랜더링이 크게 사용되었다
> 하지만 2010년대 중반 이후 SSR과 서버 캐시가 다시 부각되는데
>
> 그 이유는 크게 두가지로 나뉜다.
> 첫번째 이유는 **검색 엔진 최적화**이다. 이커머스 페이지나 모바일 애플리케이션이 아닌경우 구글이나 네이버 검색엔진 노출 점수를 크게 올리기 위해서이는 각페이지에 검색엔진에 노출되기 쉬운 태그들을 작성해주어야하는데 SPA는 단일 페이지로 접근을하고 단일 페이지로 끝나기때문에 힘들기 때문에 SSR을 선호하게 되었다.
> **두번째 이유는 캐시메모리라고 볼수있다.** SSR이 인기가 다시 시작되면서 캐시메모리가 사용되었는데 이 캐시메모리를 사용하므로서 데이터 조회(응답속도)가 빨라짐으로서 데이터 기반 서버 측 랜더링 속도가 빨라졌다. 이것은 TTV(time to view) 즉 라우팅간 이동속도라던지 초기 로드속도의 이점을 극대화하기 시작했고 사용자 경험을 우수하게 만들어주었다.

## 클라이언트 캐시

- **클라이언트 캐시란?**

  - 클라이언트 캐시는 웹 브로우저 또는 클라이언트 기기에 의해 관리되는 캐시 메커니즘을 가리킨다.
  - 클라이언트 측에서 이전에 다운로드한 웹 페이지 및 정적 리소스의 복사본을 저장하고 재사용한다.

- **클라이언트 캐시의 역할**

  - 클라이언트 캐시는 동일한 웹 페이지를 다시 방문할 때에, 서버에서 해당 리소스를 다시 다운로드 하지 않고 저장된 캐시에서 해당 리소스를 로드하여 웹 페이지 로딩 시간을 단축시킨다. 이로서 사용자의 경험을 향상 시키고 대역폭을 절약할수 있다.

- **클라이언트 캐시 사용 사례**

  - 클라이언트 캐시는 주로 웹 브라우저에서 사용된다.
  - 웹 브라우저는 이전에 방문한 웹 페이지의 리소스를 로컬 디스크에 저장하고 캐시한다. 이를 통해 사용자가 동일한 웹 페이지를 다시 방문할 때 해당 리소스를 다시 다운로드하지 않고 캐시에서 가져온다.
  - 이를 통해 사용자가 동일한 웹 페이지를 다시 방문 할 때 해당 리소스를 다시 다운로드하지 않고 캐시에서 가져온다.

- **클라이언트 캐시 구현**

  - 브라우저 캐시는 웹 브라우저 자체에 내장되어있고, 웹 사이트 제작자는 캐시 제어를 위해 HTTP 헤더(예 : CaChe-Control 헤더)를 사용할 수있다.
  - 브라우저는 이러한 헤더를 해석해서 리소스를 언제 캐시하고 언제 다시 다운로드해야하는지 결정한다.

## 네트워크 캐시

- **네트워크 캐시란?**

  - 네트워크 캐시는 콘텐츠 전달 네트워크인 `CDN`에서 사용되는 캐시 메커니즘을 가리킨다. `CDN`은 웹 콘텐츠의 복사본을 전 세계적으로 분산된 서버에 저장하고 캐시해서 콘텐츠를 빠르게 전달하는데 사용된다.

- **네트워크 캐시의 역할**

  - 네트워크 캐시는 웹 콘텐츠를 사용자에게 가장 가까운 위치에서 제공하여 응답 시간을 최소화한다. `CDN`은 콘텐츠를 미리 캐시하고 콘텐츠가 가장 빠른 경로로 전달되도록 보장한다.

- **네트워크 캐시 사용사례**

  - `CDN`은 정적 콘텐츠(이미지, 비디오, 스타일시트) 및 동적 콘텐츠(API응답)를 캐시하는 데 사용된다. 대규모 웹 사이트 및 콘텐츠 제공 업체는 CDN을 통해 콘텐츠의 배송 및 캐싱을 최적화한다.

- **네트워크 캐시 구현**

  - CDN은 전문적인 서비스 제공업체(AWS cloudfront, Akamai)를 통해 구현된다. 웹사이트 소유자 및 운영자는 CDN 서비스를 구독하고 웹 콘텐츠를 해당 CDN에 호스팅 하여 캐시 및 전달 설정을 구성한다.

## 캐시 히트와 미스

- **캐시 히트와 미스의 개념**

  - 캐시 히트는 캐시에서 데이터를 검색할 때 해당 데이터가 캐시에 존재하여 빠르게 찾아내는 경우를 가리킨다. 반면 캐시 미스는 요청한 데이터가 캐시에 없어서 원본 데이터 소스에서 검색해야 하는 경우를 말한다.

- **언제 캐시 히트 또는 미스가 발생하는가?**

  - 캐시 히트는 이전에 검색한 데이터를 다시 요청할 때 발생하며, 캐시에 해당 데이터가 여전히 유지되고 있을 때 발생한다. 캐시 미스는 새로운 데이터를 요청하거나 캐시에 해당 데이터가 만료되었을 때 발생한다.

- **캐시 성능 개선을 위한 방법**

  - 적절한 캐시 정책 설정: 데이터의 적절한 캐시 유지 기간 및 제어 정책 설정.
  - 캐시 키 설계: 캐시 키를 고유하게 식별 가능하도록 설계하여 검색 및 무효화를 관리.
  - 캐시 히트 모니터링: 캐시 히트 및 미스를 모니터링하여 캐시 성능을 개선할 수 있는 영역 식별.

## 캐시 제어와 무효화

- **캐시 제어란?**

  - 캐시 제어는 캐시에 저장된 데이터를 언제 갱신하거나 제거해야 하는지 결정하는 메커니즘을 가리킨다.

- **캐시의 데이터 무효화 (캐시 삭제 및 갱신)**

  - 캐시의 데이터 무효화는 캐시에 저장된 데이터를 갱신하거나 제거하는 것을 의미한다. 데이터가 업데이트되거나 더 이상 유효하지 않을 때, 캐시에서 해당 데이터를 제거하거나 갱신해야 한다.

- **캐시 제어 헤더 (예: HTTP 캐시 제어 헤더)**
  - HTTP 프로토콜은 캐시 제어를 위한 여러 헤더를 제공한다. "Cache-Control" 헤더와 "Expires" 헤더를 사용하여 캐시 유효 기간, 캐시 무효화 및 캐시 동작을 제어할 수 있다.

### 헤더 예시

- `Cache Hit` : 적중 -> 저장소에 있음
  - GET /user -> cache -> 서버 -> cache -> HTTP1.1 200 ok 신선도 (cache-controll : max-age)
    - (cache-controll : max-age) : 캐시자체를 얼마나 보관할지
    - Last-Modified : 캐시랑 서버 비교 date
    - Etag :캐시랑 서버 비교 문서 “값”
  - Cache 가 오래됬는데 서버에 물어보니 변경이 없는경우Ex) GET /count HTTP/1.1 304 not Modified
  - Cache가 오래됐는데 서버에 물어보니 썩어서 바뀌었다고 하는경우 Ex) GET /count HTTP/1.1 200 ok
- `Cache-controller`
  - `max-age =6` : 6초동안 보관 -> 유통기한
  - `no-cache` : 캐시 저장해도되는데 신선도 항상 검사해
  - `must-revalidate` : 유통기한 지나면 꼭 서버한테 검사해
    - cache가 오래 됐는데 그냥 오래된거 줄때도 있음
      - Stale-While-Revalidate => swr라이브러리 => 일단 오래된거 주고 , 뒤에서 서버한테 Last-modified Etag 보고 비교 물어봐서 새거 있으면 몰래 업데이트 해놔
      - Stale-If-Error => 서버쪽에서 에러나더라도 캐시에 오래된것이 있으면 일단 오래된거 줌
  - `private` = default 캐시는 보통 본인 메모리 프라이빗하게 씀
  - `public` = 메모리를 공유함 만약 header에 Authorization 있으면 적용 안됌
- `Cache Miss` : 부적중 -> 없음

## 캐시 보안 및 개인 정보 보호

- **캐시와 보안의 관계**

  - 캐시는 데이터를 저장하고 재사용하는 메커니즘이므로 보안 및 개인 정보 보호에 중요한 영향을 미친다. 보안 측면에서 캐시는 민감한 정보가 노출되는 것을 방지하고, 개인 정보 보호를 위한 정책을 준수해야 한다.

- **개인 정보 보호를 위한 캐시 정책**
  - 웹 애플리케이션 및 서버는 캐시 정책을 통해 개인 정보 보호를 강화해야 한다. 개인 정보가 포함된 데이터는 캐시하지 않거나 안쓰는게 좋다.

## 캐시 사용 사례

- **웹 페이지 캐싱**

  - 웹 페이지의 정적 콘텐츠 (HTML, CSS, JavaScript)를 캐싱하여 웹 페이지 로딩 속도를 향상시킨다.

- **API 응답 캐싱**

  - 웹 애플리케이션에서 사용되는 API 응답을 캐싱하여 빠른 데이터 액세스를 제공하고 서버 부하를 감소시킨다.

- **이미지 및 미디어 캐싱**

  - 웹 사이트의 이미지, 비디오 및 오디오 파일을 캐싱하여 페이지의 미디어 컨텐츠를 효율적으로 제공한다.

- **동적 콘텐츠 캐싱**
  - 동적으로 생성되는 콘텐츠 (예: 뉴스 피드, 실시간 주식 가격)를 캐싱하여 빠른 응답과 서버 부하 감소를 달성한다.

## 캐시의 이점과 한계

- **캐시의 이점**

  - 빠른 응답 시간: 캐시를 통해 이전에 검색한 데이터를 빠르게 제공할 수 있어 사용자 경험을 향상시킨다.
  - 서버 부하 감소: 캐시를 통해 반복적인 데이터 액세스와 연산을 피하므로 서버 부하가 감소한다.
  - 대역폭 절약: 캐시를 통해 동일한 데이터를 반복해서 다운로드할 필요가 없어 대역폭을 절약한다.

- **캐시 사용에 따른 주의사항**

  - **캐시 무효화 관리**: 데이터의 업데이트 또는 무효화를 관리하고, 캐시된 데이터가 유효한지 확인해야 한다.
  - **개인 정보 보호**: 민감한 데이터는 캐시하지 않거나 적절하게 보호해야 한다.

- **캐시를 통한 성능 향상**
  - 캐시는 웹 애플리케이션 및 서버 성능을 향상시키는 데 중요한 역할을 한다. 캐시를 올바르게 구성하고 관리하면 응답 시간을 단축시키고 사용자 경험을 향상시킬 수 있다.

## 실제 시나리오 및 예제

- **웹 애플리케이션의 클라이언트 캐시 구현**

  - 웹 애플리케이션에서 정적 리소스 (이미지, 스타일시트, 스크립트)를 브라우저 캐시를 통해 제공하는 방법을 예제로 살펴볼 수 있다. 이를 통해 웹 페이지 로딩 성능을 개선할 수 있다.

- **서버에서 데이터 캐싱**

  - 서버에서 API 응답을 캐싱하여 동일한 데이터에 대한 반복적인 요청을 처리하고 서버 응답 시간을 단축하는 방법을 예제로 살펴볼 수 있다.

- **CDN을 사용한 네트워크 캐싱**
  - CDN을 사용하여 웹 콘텐츠를 캐시하고 전 세계적으로 제공하는 방법을 예제로 살펴볼 수 있다. 이를 통해 글로벌 사용자에게 빠른 응답 시간을 제공할 수 있다.
